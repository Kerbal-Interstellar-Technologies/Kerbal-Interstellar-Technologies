PART
{
	// --- general parameters ---
	name = kspiSurge
	module = Part
	author = K.Yeon, JadeOfMaar
	tags = opt mk2 deep sky magnet magneto surge plasma jet

	// --- asset parameters ---
	scale = 1
	rescaleFactor = 1
	
	MODEL
	{
		model = WarpPlugin/Parts/Engines/SURGE/OPT_J60
	}

	// --- node definitions ---
	node_stack_top = 0.0, 3.99574, 0.0, 0.0, 1.0, 0.0, 3
	node_attach = 1.25, 0.0, 0.0, 0.0, 1.0, 0.0, 4	

	
	// --- editor parameters ---
	TechRequired = specializedFusionRockets
	entryCost = 700000 
	cost = 165000
	category = Engine
	subcategory = 0
	title = KSPI-E WarpJet "S.U.R.G.E."
	manufacturer = OPM Propulsion Science Division
	description = The awkward design of this engine when it was first released was a factor to be considered when it bankrupted OPT. Assistance came from a mysterious agency called "Deep Sky," which presented a prototype engine refitted with what was called WarpJet, a technology for compressing and combusting any kind of air through a super-powered magnetic coil assembly. With scrutiny, OPT accepted and coupled the WarpJet with S.C.O.O.P., creating the S.U.R.G.E (Sidelong Undulating Respirating Gauss Engine).

	// attachment rules: stack, srfAttach, allowStack, allowSrfAttach, allowCollision
	attachRules = 1,1,1,1,0


	// --- standard part parameters ---
	mass = 16
	dragModelType = default
	maximum_drag = 0.2
	minimum_drag = 0.2
	angularDrag = 2
	bulkheadProfiles = mk2, srf
	crashTolerance = 12
	breakingForce = 400
	breakingTorque = 600
	maxTemp = 3200
	emissiveConstant = 1.4 // engine nozzles are good at radiating.

	// Resources
	RESOURCE
	{
		name = ThermalPower
		amount = 0
		maxAmount = 20000
	}

	RESOURCE
	{
		name = ChargedParticles
		amount = 0
		maxAmount = 20000
	}

	RESOURCE
	{
		name = WasteHeat
		amount = 0
		maxAmount = 20000
	}

	RESOURCE
	{
		name = Megajoules
		amount = 0
		maxAmount = 40000
	}

	RESOURCE
	{
		name = ElectricCharge
		amount = 1000
		maxAmount = 1000
	}

	RESOURCE
	{
		name = LithiumDeuteride
		amount = 100
		maxAmount = 100
	}

	MODULE
	{
		name = InertialConfinementReactor
		reactorType = 8
		partMass = 8
		radius = 2.5
		supportMHD = true			// will make use of core temperature when connected to MHD generator
		reactorModeTechBonus = 2		// determines initial unlocked fusion fuel tech level
		reactorSpeedMult = 0 			// instant acceleration

		hotBathTemperatureMk1 = 3000
		hotBathTemperatureMk2 = 3500
		hotBathTemperatureMk3 = 4000
		hotBathTemperatureMk4 = 4500

		coreTemperatureMk1 = 40000
		coreTemperatureMk2 = 80000
		coreTemperatureMk3 = 160000
		coreTemperatureMk4 = 320000

		basePowerOutputMk1 = 2000
		basePowerOutputMk2 = 3000
		basePowerOutputMk3 = 4500
		basePowerOutputMk4 = 6750

		fusionEnergyGainFactorMk1 = 30
		fusionEnergyGainFactorMk2 = 45
		fusionEnergyGainFactorMk3 = 65
		fusionEnergyGainFactorMk4 = 90

		fuelModeTechReqLevel2 = PlasmaJetFuelUpgrade0
		fuelModeTechReqLevel3 = PlasmaJetFuelUpgrade1
		fuelModeTechReqLevel4 = PlasmaJetFuelUpgrade2

		upgradeTechReqMk2 = PlasmaJetUpgrade2
		upgradeTechReqMk3 = PlasmaJetUpgrade3
		upgradeTechReqMk4 = PlasmaJetUpgrade4		

		minimumThrottle = 0.0
		consumeGlobal = false
		fuelEfficiency = 1
		upgradedFuelEfficiency = 1

		engineHeatProductionMult = 1 			// reduce thermal engine heat production by 25%
		engineWasteheatProductionMult = 1		// keep propulsion wasteheat at 100%

		thermalPropulsionEfficiency = 1			// can use thermal nozzle
		plasmaPropulsionEfficiency = 1			// can use plasma nozzle
		chargedParticlePropulsionEfficiency = 0		// cannot use magnetic nozzle

		thermalEnergyEfficiency = 0			// cannot use thermal generator
		plasmaEnergyEfficiency = 0.5			// can use 50% MHD generator	
		chargedParticleEnergyEfficiency = 0		// cannot be used with direct converter

		neutronEmbrittlementLifepointsMax = 1000
		neutronEmbrittlementDivider = 1e+9

		thermalProcessingModifier = 0.75
		startupPowerMultiplier = 1
		powerPercentage = 100

		canUseNeutronicFuels = true
		canBreedTritium = false
		canDisableTritiumBreeding = false

		electricPowerPriority = 3 			// determines power production priority for connected generator
	}

	MODULE
	{
		name = ThermalElectricPowerGenerator
		chargedParticleMode = false
		isMHD = true

		efficiencyMk1 = 0.65
		efficiencyMk2 = 0.70
		efficiencyMk3 = 0.75
		efficiencyMk4 = 0.80

		Mk2TechReq = MHDGeneratorUpgradeA
		Mk3TechReq = MHDGeneratorUpgradeB
		Mk4TechReq = MHDGeneratorUpgradeC

		upgradedName = MHD Electric Generator
		originalName = MHD Electric Generator

		animName = e7
		radius = 2.5

		massModifier = 2
		rawPowerToMassDivider = 1000
	
		sHighPower = true
		calculatedMass = true
		maintainsMegaWattPowerBuffer = true
	}



//	MODULE
//	{
//		name = ModuleEnginesFX
//		engineID = WJOpen
//		thrustVectorTransformName = thrustTransform
//		exhaustDamage = True
//		ignitionThreshold = 0.03
//		minThrust = 0
//		maxThrust = 750
//		heatProduction = 160
//		useEngineResponseTime = True
//		engineAccelerationSpeed = 0.7 // 0.1
//		engineDecelerationSpeed = 0.35 // 0.25
//		useVelocityCurve = False
//		flameoutEffectName = flameout
//		powerEffectName = running_open
//		engageEffectName = engage
//		disengageEffectName = disengage
//		spoolEffectName = running_turbine
//		engineSpoolIdle = 0.05
//		engineSpoolTime = 1.0
//		EngineType = Electric
//		exhaustDamageMultiplier = 600
//		exhaustDamageMaxRange = 20
//		PROPELLANT
//		{
//			name = ElectricCharge
//			ratio = 3.1
//			DrawGauge = True
//		}
//
//		PROPELLANT
//		{
//			name = IntakeAir
//			ratio = 1
//			DrawGauge = True
//		}
//		atmosphereCurve
//		{
//			// Isp
//			key = 0 300
//			key = 1 240 -22.22222 -12.72055
//			key = 10 190 -1.065011 0
//		}
//		
//		// Jet params
//		atmChangeFlow = True
//		useVelCurve = False
//		useAtmCurve = True
//		velCurve
//		{
//			key = 0 1.5
//			key = 0.7221704 1.493785 -0.04722485 -0.1400709
//			key = 4.4 1 -0.003708204 0.003697131
//		}
//		atmCurve
//		{
//			//Atm pressure vs thrust mult
//			key = 0 1.5 0 0
//			key = 0.01 2 0 0
//			key = 0.2 2 0 0
//			key = 0.5 1 0 0
//			key = 1 1 0 0
//			key = 5 2.5 -0.03847784 -0.25
//		}
//	}

	MODULE
	{
		name = ModuleEnginesFX

		thrustVectorTransformName = thrustTransform
		exhaustDamage = True
		ignitionThreshold = 0.1
		minThrust = 0
		maxThrust = 300
		heatProduction = 100

		flameoutEffectName = flameout
		engageEffectName = engage
		disengageEffectName = disengage
		spoolEffectName = running_turbine

		engineSpoolIdle = 0.05
		engineSpoolTime = 1.0
		
		PROPELLANT
		{
			name = IntakeAtm
			ratio = 1
		}
		atmosphereCurve
 		{
			key = 0 1200
			key = 0.3 2500
			key = 1 800
 		}
		velocityCurve
		{
			key = 0 1 0 0
			key = 400 0.8 0 0
			key = 800 0.9 0 0
			key = 1700 0 0 0
		}	
	}

	MODULE
	{
		name = ThermalNozzleController

		isJet = true
		canUseLFO = true
		isPlasmaNozzle = false
		upgradeTechReq = true
		afterburnerTechReq = true
		showPartTemperature = true
		usePropellantBaseIsp = true			// Will use propellant Base Isp

		radius = 2.5
		exitArea = 1
		partMass = 4
		maxTemp = 3200

		minimumBaseIsp = 700				// Minimum Isp using Hydrogen
		maxThermalNozzleIsp = 4000
		IspTempMultOffset = -0.2357269918213

		powerTrustMultiplier = 0.95
		powerTrustMultiplierJet = 1

		EffectNameLFO = running_open
		EffectNameNonLFO = running_open

		sootHeatDivider = 50
		sootThrustDivider = 150

		heatProductionMultiplier = 0.25
		baseHeatProduction = 80		
		jetPerformanceProfile = 1			// Turbojet

        	overrideAtmCurve = true;
        	overrideVelocityCurve = true;
        	overrideAtmosphereCurve = true;
        	overrideAccelerationSpeed = true;
        	overrideDecelerationSpeed = true;
		
		supportedPropellantAtoms = 442 			// He + C + N + O + Ar + Xe = 2 + 8 + 16 + 32 + 128 + 256
		supportedPropellantTypes = 511  		// any molecular type
	}
	
	MODULE
	{
		name = ModuleSurfaceFX
		thrustProviderModuleIndex = 0
		fxMax = 0.6
		maxDistance = 25
		falloff = 2
		thrustTransformName = thrustTransform
	}
	
	MODULE
	{
		name = ModuleGimbal
		gimbalTransformName = thrustTransform
		gimbalResponseSpeed = 4
		useGimbalResponseSpeed = true
		gimbalRangeXP = 1
		gimbalRangeXN = 1
		gimbalRangeYP = 4
		gimbalRangeYN = 4
		gimbalRangeZP = 0
		gimbalRangeZN = 0
	}
	
	EFFECTS
	{		
		running_open
		{
			PREFAB_PARTICLE
			{
				prefabName = fx_smokeTrail_light
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.0
				emission = 0.075 0.25
				emission = 1.0 1.25
				speed = 0.0 0.25
				speed = 1.0 1.0
				localOffset = 0, 0, 1
				localRotation = 1, 0, 0, -90
			}
			MODEL_MULTI_PARTICLE
			{
				name = Blaze
				modelName = WarpPlugin/FX/SAGEBlaze
				transformName = thrustTransform
				emission = 0.05 0
				emission = 0.1 1
				speed = 0 0.1
				speed = 1 0.2 0.312365 0.312365
				speed = 2 1
				energy = 1.5 1 0 0
				energy = 2 1.5
			}
			MODEL_MULTI_PARTICLE
			{
				name = Stream1
				modelName = WarpPlugin/FX/SAGEStream
				transformName = FXNode
				emission = 0.05 0
				emission = 0.5 1
				energy = 0 0.2
				energy = 1 1 0 0
				energy = 1.5 1 0 0
				energy = 2 1.5
			}
			MODEL_MULTI_PARTICLE
			{
				name = ShockPulse1
				modelName = WarpPlugin/FX/s2ShockPulse
				transformName = FXNode
				emission = 1.1 0
				emission = 1.2 1
				energy = 1.2 0.2
				energy = 2 1
				localPosition = 0, 0, 1
				localScale = 0.75, 0.75, 0.75
			}
			MODEL_MULTI_PARTICLE
			{
				name = Stream2
				modelName = WarpPlugin/FX/SAGEStream
				transformName = FXNode1
				emission = 1.2 0
				emission = 1.3 1
				speed = 1.3 1.5
				speed = 2 2
				energy = 1.3 0.4
				energy = 2 1
				localPosition = 0, 0, 1
				localScale = 0.75, 0.75, 0.75
			}
			MODEL_MULTI_PARTICLE
			{
				name = ShockPulse2
				modelName = WarpPlugin/FX/s2ShockPulse
				transformName = FXNode1
				emission = 1.2 0
				emission = 1.3 1
				speed = 1.3 1.5
				speed = 2 2
				energy = 1.3 0.4
				energy = 2 1
				localPosition = 0, 0, 1
				localScale = 0.75, 0.75, 0.75
			}
			AUDIO
			{
				name = ramp
				channel = Ship
				clip = WarpPlugin/Sounds/engine_1
				volume = 0.5 0
				volume = 1.5 2
				pitch = 0.0 0.8
				pitch = 0.5 1
				pitch = 1.0 2
				loop = true
				speed = 0.0 1 0 0
				speed = 2.0 2 1.2 0
			}
			AUDIO
			{
				name = scream
				channel = Ship
				clip = WarpPlugin/Sounds/engine_2
				volume = 1.3 0 0 0
				volume = 1.31 1.5 0 0
				volume = 2 3 0 0
				pitch = 0.5 0.5
				pitch = 1.5 0.7
				pitch = 2 1.5
				loop = true
				speed = 1.5 1
				speed = 2 2
			}
		}		
		running_turbine
		{
			AUDIO
			{
				channel = Ship
				clip = WarpPlugin/Sounds/engine_1
				volume = 0.0 0.0
				volume = 0.05 0.4
				volume = 1.0 0.7
				volume = 1.2 1.0
				pitch = 0.0 0.5
				pitch = 0.05 0.5
				pitch = 0.5 2
				pitch = 1.0 1
				loop = true
			}
		}
		
		engage
		{
			AUDIO
			{
				channel = Ship
				clip = WarpPlugin/Sounds/seismiccharge
				volume = 0.5
				pitch = 1.0
				loop = false
			}
		}
		
		disengage
		{
			AUDIO
			{
				channel = Ship
				clip = WarpPlugin/Sounds/seismiccharge
				volume = 0.35
				pitch = 1.0
				loop = false
			}
		}
		
		flameout
		{
			PREFAB_PARTICLE
			{
				prefabName = fx_exhaustSparks_flameout_2
				transformName = thrustTransform
				oneShot = true
			}
			
			AUDIO
			{
				channel = Ship
				clip = sound_explosion_low
				volume = 1.0
				pitch = 2.0
				loop = false
			}
		}
	}

	MODULE
	{
		name = FXModuleAnimateThrottle
		animationName = engine_light
		dependOnEngineState = True
		responseSpeed = 0.01
	}
	
	MODULE
	{
		name = TweakScale
		type = stack
		defaultScale = 2.5
		scaleFactors = 0.625, 0.95, 1.25, 1.875, 2.5, 3.75, 5.0, 7.5, 10, 15, 20, 30, 40
	}

	MODULE
	{
		name = ModuleLiftingSurface
		useInternalDragModel = False
		deflectionLiftCoeff = 1
		dragAtMaxAoA = 0.3
		dragAtMinAoA = 0.1
	}
}